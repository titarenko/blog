
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Constantin Titarenko's Blog</title>
	<meta name="author" content="Constantin Titarenko">

	
	<meta name="description" content="While being in a state of active development, you really can be confused by a question: &ldquo;What have you done during last week?&rdquo;. You are &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Constantin Titarenko's Blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script async="true" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>


<body>
	<header id="header" class="inner"><h1><a href="/">Constantin Titarenko's Blog</a></h1>
<nav id="main-nav"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main">
	<li><a href="/">Blog</a></li>
	<li><a href="/blog/archives">Archives</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:blog.titarenko.info">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/ctitarenko" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/titarenko" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
    
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:blog.titarenko.info">
	</form>
</nav>

</header>
	
		
	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/07/09/what-have-i-done-during-last-week/">
		
			What Have I Done During Last Week?</a>
	</h2>
	<div class="entry-content">
		<p>While being in a state of active development, you really can be confused by a question: &ldquo;What have you done during last week?&rdquo;. You are focused on current task, so obviously you are out of context of previous tasks &ndash; this is OK.</p>

<p>Anyway, since you are using Git, it&rsquo;s extremely easy to answer initial question:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git log --since<span class="o">=</span><span class="s2">&quot;2013-06-23&quot;</span> --until<span class="o">=</span><span class="s2">&quot;2013-06-29&quot;</span> --author<span class="o">=</span><span class="s2">&quot;Constantin Titarenko&quot;</span> --pretty<span class="o">=</span><span class="s2">&quot;%ad %s&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>This command will yield something like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Sat Jun 29 12:51:32 2013 +0300 Fixed spelling.
</span><span class='line'>Sat Jun 29 12:49:31 2013 +0300 Translated comments template to Russian.
</span><span class='line'>Sat Jun 29 12:48:59 2013 +0300 Russian date format.
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-07-09T23:24:00+03:00" pubdate data-updated="true">Jul 9<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/categories/git/'>git</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/07/17/asp-net-mvc-preparing-for-deployment/">
		
			ASP.NET MVC - Preparing for Deployment</a>
	</h2>
	<div class="entry-content">
		<p>Development process of several of my pet projects reached stage when robust deployment process is needed. So, I decided to consider list of options and started googling.</p>

<p>I found that msbuild itself allows to do packaging for deployment (but very few developers were recommending to use it for real-life deployment).</p>

<p>Other option was use of NAnt &ndash; but disadvantages were that it needs to write configuration in XML, which is quite verbose way of expressing things, and also it has little or no development activity as for now.</p>

<p>But then I spotted <a href="https://github.com/psake/psake">psake</a> which seemed to be like rake, but for PowerShell, not Ruby. I even read nice post with real life example from <a href="http://ayende.com/blog/4156/on-psake" title="">Ayende</a>.</p>

<p>So, decision was made &ndash; packaging will be done by script written in PowerShell. Advantages:</p>

<ul>
<li>no need in additional interpreter/dependencies (as in case with rake)</li>
<li>ability to use .NET types from script</li>
<li>quite expressive language and decent syntax</li>
<li>no need to write tons of XML</li>
</ul>


<p>So, for one of projects, I even didn&rsquo;t use psake and expressed everything in plain PowerShell with only dependency on 7-zip for creating zip archive and it&rsquo;s only few lines of clean and understandable code &ndash; you can look at it <a href="https://github.com/titarenko/ClientManager/blob/master/BinaryStudio.ClientManager.WebUi/Deployment/Package.ps1">here, on Github</a> (it&rsquo;s well commented, so it&rsquo;s good place to start if you haven&rsquo;t written such things before).</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-07-17T00:00:00+03:00" pubdate data-updated="true">Jul 17<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/categories/dot-net/'>.NET</a>, <a class='category' href='/categories/deployment/'>Deployment</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/06/10/nullreferenceexception-from-the-entity-framework-core/">
		
			NullReferenceException From the Entity Framework Core</a>
	</h2>
	<div class="entry-content">
		<p>Running web application with Entity Framework 4.3 I got very strange (at first glance) exception saying: <code>"Object reference not set to an instance of an object."</code>. Following is the controller action caused this error:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="n">ActionResult</span> <span class="nf">Index</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="nf">View</span><span class="p">(</span><span class="n">repository</span><span class="p">.</span><span class="n">Query</span><span class="p">&lt;</span><span class="n">Story</span><span class="p">&gt;().</span><span class="n">ToList</span><span class="p">());</span>
</span><span class='line'>    <span class="c1">// repository.Query&lt;Story&gt;() here is nothing but (DbQuery&lt;Story&gt;) context.Stories</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here is the stack trace:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[NullReferenceException: Object reference not set to an instance of an object.]</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Objects</span><span class="p">.</span><span class="n">ELinq</span><span class="p">.</span><span class="n">QueryParameterExpression</span><span class="p">.</span><span class="n">EvaluateParameter</span><span class="p">(</span><span class="n">Object</span><span class="p">[]</span> <span class="n">arguments</span><span class="p">)</span> <span class="p">+</span><span class="m">83</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Objects</span><span class="p">.</span><span class="n">ELinq</span><span class="p">.</span><span class="n">ELinqQueryState</span><span class="p">.</span><span class="n">GetExecutionPlan</span><span class="p">(</span><span class="n">Nullable</span><span class="err">`</span><span class="m">1</span> <span class="n">forMergeOption</span><span class="p">)</span> <span class="p">+</span><span class="m">779</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Objects</span><span class="p">.</span><span class="n">ObjectQuery</span><span class="err">`</span><span class="m">1.</span><span class="n">GetResults</span><span class="p">(</span><span class="n">Nullable</span><span class="err">`</span><span class="m">1</span> <span class="n">forMergeOption</span><span class="p">)</span> <span class="p">+</span><span class="m">149</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Objects</span><span class="p">.</span><span class="n">ObjectQuery</span><span class="err">`</span><span class="m">1.</span><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;.</span><span class="n">GetEnumerator</span><span class="p">()</span> <span class="p">+</span><span class="m">44</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Entity</span><span class="p">.</span><span class="n">Internal</span><span class="p">.</span><span class="n">Linq</span><span class="p">.</span><span class="n">InternalQuery</span><span class="err">`</span><span class="m">1.</span><span class="n">GetEnumerator</span><span class="p">()</span> <span class="p">+</span><span class="m">40</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Data</span><span class="p">.</span><span class="n">Entity</span><span class="p">.</span><span class="n">Infrastructure</span><span class="p">.</span><span class="n">DbQuery</span><span class="err">`</span><span class="m">1.</span><span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">TResult</span><span class="p">&gt;.</span><span class="n">GetEnumerator</span><span class="p">()</span> <span class="p">+</span><span class="m">40</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">List</span><span class="err">`</span><span class="m">1.</span><span class="p">.</span><span class="n">ctor</span><span class="p">(</span><span class="n">IEnumerable</span><span class="err">`</span><span class="m">1</span> <span class="n">collection</span><span class="p">)</span> <span class="p">+</span><span class="m">315</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Linq</span><span class="p">.</span><span class="n">Enumerable</span><span class="p">.</span><span class="n">ToList</span><span class="p">(</span><span class="n">IEnumerable</span><span class="err">`</span><span class="m">1</span> <span class="n">source</span><span class="p">)</span> <span class="p">+</span><span class="m">58</span>
</span><span class='line'>   <span class="n">QTeam</span><span class="p">.</span><span class="n">PlanningBoard</span><span class="p">.</span><span class="n">Controllers</span><span class="p">.</span><span class="n">StoriesController</span><span class="p">.</span><span class="n">Index</span><span class="p">()</span> <span class="k">in</span> <span class="p">...</span><span class="n">QTeam</span><span class="p">.</span><span class="n">PlanningBoard</span><span class="err">\</span><span class="n">Controllers</span><span class="err">\</span><span class="n">StoriesController</span><span class="p">.</span><span class="n">cs</span><span class="p">:</span><span class="m">26</span>
</span><span class='line'>   <span class="n">lambda_method</span><span class="p">(</span><span class="n">Closure</span> <span class="p">,</span> <span class="n">ControllerBase</span> <span class="p">,</span> <span class="n">Object</span><span class="p">[]</span> <span class="p">)</span> <span class="p">+</span><span class="m">97</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">ActionMethodDispatcher</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">ControllerBase</span> <span class="n">controller</span><span class="p">,</span> <span class="n">Object</span><span class="p">[]</span> <span class="n">parameters</span><span class="p">)</span> <span class="p">+</span><span class="m">17</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">ReflectedActionDescriptor</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">ControllerContext</span> <span class="n">controllerContext</span><span class="p">,</span> <span class="n">IDictionary</span><span class="err">`</span><span class="m">2</span> <span class="n">parameters</span><span class="p">)</span> <span class="p">+</span><span class="m">208</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">ControllerActionInvoker</span><span class="p">.</span><span class="n">InvokeActionMethod</span><span class="p">(</span><span class="n">ControllerContext</span> <span class="n">controllerContext</span><span class="p">,</span> <span class="n">ActionDescriptor</span> <span class="n">actionDescriptor</span><span class="p">,</span> <span class="n">IDictionary</span><span class="err">`</span><span class="m">2</span> <span class="n">parameters</span><span class="p">)</span> <span class="p">+</span><span class="m">27</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.&lt;&gt;</span><span class="n">c__DisplayClass15</span><span class="p">.&lt;</span><span class="n">InvokeActionMethodWithFilters</span><span class="p">&gt;</span><span class="n">b__12</span><span class="p">()</span> <span class="p">+</span><span class="m">55</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">ControllerActionInvoker</span><span class="p">.</span><span class="n">InvokeActionMethodFilter</span><span class="p">(</span><span class="n">IActionFilter</span> <span class="n">filter</span><span class="p">,</span> <span class="n">ActionExecutingContext</span> <span class="n">preContext</span><span class="p">,</span> <span class="n">Func</span><span class="err">`</span><span class="m">1</span> <span class="n">continuation</span><span class="p">)</span> <span class="p">+</span><span class="m">263</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.&lt;&gt;</span><span class="n">c__DisplayClass17</span><span class="p">.&lt;</span><span class="n">InvokeActionMethodWithFilters</span><span class="p">&gt;</span><span class="n">b__14</span><span class="p">()</span> <span class="p">+</span><span class="m">19</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">ControllerActionInvoker</span><span class="p">.</span><span class="n">InvokeActionMethodWithFilters</span><span class="p">(</span><span class="n">ControllerContext</span> <span class="n">controllerContext</span><span class="p">,</span> <span class="n">IList</span><span class="err">`</span><span class="m">1</span> <span class="n">filters</span><span class="p">,</span> <span class="n">ActionDescriptor</span> <span class="n">actionDescriptor</span><span class="p">,</span> <span class="n">IDictionary</span><span class="err">`</span><span class="m">2</span> <span class="n">parameters</span><span class="p">)</span> <span class="p">+</span><span class="m">191</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">ControllerActionInvoker</span><span class="p">.</span><span class="n">InvokeAction</span><span class="p">(</span><span class="n">ControllerContext</span> <span class="n">controllerContext</span><span class="p">,</span> <span class="n">String</span> <span class="n">actionName</span><span class="p">)</span> <span class="p">+</span><span class="m">343</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Controller</span><span class="p">.</span><span class="n">ExecuteCore</span><span class="p">()</span> <span class="p">+</span><span class="m">116</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">ControllerBase</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">RequestContext</span> <span class="n">requestContext</span><span class="p">)</span> <span class="p">+</span><span class="m">97</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">ControllerBase</span><span class="p">.</span><span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">IController</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">RequestContext</span> <span class="n">requestContext</span><span class="p">)</span> <span class="p">+</span><span class="m">10</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.&lt;&gt;</span><span class="n">c__DisplayClassb</span><span class="p">.&lt;</span><span class="n">BeginProcessRequest</span><span class="p">&gt;</span><span class="n">b__5</span><span class="p">()</span> <span class="p">+</span><span class="m">37</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Async</span><span class="p">.&lt;&gt;</span><span class="n">c__DisplayClass1</span><span class="p">.&lt;</span><span class="n">MakeVoidDelegate</span><span class="p">&gt;</span><span class="n">b__0</span><span class="p">()</span> <span class="p">+</span><span class="m">21</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Async</span><span class="p">.&lt;&gt;</span><span class="n">c__DisplayClass8</span><span class="err">`</span><span class="m">1.</span><span class="p">&lt;</span><span class="n">BeginSynchronous</span><span class="p">&gt;</span><span class="n">b__7</span><span class="p">(</span><span class="n">IAsyncResult</span> <span class="n">_</span><span class="p">)</span> <span class="p">+</span><span class="m">12</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">Async</span><span class="p">.</span><span class="n">WrappedAsyncResult</span><span class="err">`</span><span class="m">1.</span><span class="n">End</span><span class="p">()</span> <span class="p">+</span><span class="m">62</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.&lt;&gt;</span><span class="n">c__DisplayClasse</span><span class="p">.&lt;</span><span class="n">EndProcessRequest</span><span class="p">&gt;</span><span class="n">b__d</span><span class="p">()</span> <span class="p">+</span><span class="m">50</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">SecurityUtil</span><span class="p">.&lt;</span><span class="n">GetCallInAppTrustThunk</span><span class="p">&gt;</span><span class="n">b__0</span><span class="p">(</span><span class="n">Action</span> <span class="n">f</span><span class="p">)</span> <span class="p">+</span><span class="m">7</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">SecurityUtil</span><span class="p">.</span><span class="n">ProcessInApplicationTrust</span><span class="p">(</span><span class="n">Action</span> <span class="n">action</span><span class="p">)</span> <span class="p">+</span><span class="m">22</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">MvcHandler</span><span class="p">.</span><span class="n">EndProcessRequest</span><span class="p">(</span><span class="n">IAsyncResult</span> <span class="n">asyncResult</span><span class="p">)</span> <span class="p">+</span><span class="m">60</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">Mvc</span><span class="p">.</span><span class="n">MvcHandler</span><span class="p">.</span><span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">IHttpAsyncHandler</span><span class="p">.</span><span class="n">EndProcessRequest</span><span class="p">(</span><span class="n">IAsyncResult</span> <span class="n">result</span><span class="p">)</span> <span class="p">+</span><span class="m">9</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">CallHandlerExecutionStep</span><span class="p">.</span><span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">HttpApplication</span><span class="p">.</span><span class="n">IExecutionStep</span><span class="p">.</span><span class="n">Execute</span><span class="p">()</span> <span class="p">+</span><span class="m">8970061</span>
</span><span class='line'>   <span class="n">System</span><span class="p">.</span><span class="n">Web</span><span class="p">.</span><span class="n">HttpApplication</span><span class="p">.</span><span class="n">ExecuteStep</span><span class="p">(</span><span class="n">IExecutionStep</span> <span class="n">step</span><span class="p">,</span> <span class="n">Boolean</span><span class="p">&amp;</span> <span class="n">completedSynchronously</span><span class="p">)</span> <span class="p">+</span><span class="m">184</span>
</span></code></pre></td></tr></table></div></figure>


<p>Reading such stack trace can mislead you that cause is not in app code but somewhere in the EF itself. This is because lazy enumeration &ndash; after a little bit deeper analysis I found that I have such code:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="c1">/// &lt;summary&gt;</span>
</span><span class='line'><span class="c1">/// Queries data for current tenant.</span>
</span><span class='line'><span class="c1">/// &lt;/summary&gt;</span>
</span><span class='line'><span class="k">private</span> <span class="n">IQueryable</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">QueryFilteredInternal</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">params</span> <span class="n">Expression</span><span class="p">&lt;</span><span class="n">Func</span><span class="p">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="kt">object</span><span class="p">&gt;&gt;[]</span> <span class="n">eagerlyLoadedProperties</span><span class="p">)</span> <span class="k">where</span> <span class="n">T</span> <span class="p">:</span> <span class="n">class</span><span class="p">,</span> <span class="n">IIdentifiable</span><span class="p">,</span> <span class="n">IOwned</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">repository</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Query</span><span class="p">(</span><span class="n">eagerlyLoadedProperties</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">OwnerId</span> <span class="p">==</span> <span class="n">userService</span><span class="p">.</span><span class="n">CurrentUser</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here <code>userService.CurrentUser</code> was null, so when EF tried to access <code>userService.CurrentUser.Id</code> for providing parameter value to query, <code>NullReferenceException</code> was occuring.</p>

<p>So, summary is: don&rsquo;t fully rely on call stack investigating cause for exceptions while working with lazy evaluated things.</p>

<p><em>P. S.</em> In the early beginning first thing I did was googling for stack trace. It gave me nothing but <a href="https://www.google.com.ua/search?sugexp=chrome,mod=7&amp;sourceid=chrome&amp;ie=UTF-8&amp;q=at+System.Data.Objects.ELinq.QueryParameterExpression.EvaluateParameter%28Object%5B%5D+arguments%29at+System.Data.Objects.ELinq.ELinqQueryState.GetExecutionPlan%28Nullable%601+forMergeOption%29at+System.Data.Objects.ObjectQuery%601.GetResults%28Nullable%601+forMergeOption%29at+System.Data.Objects.ObjectQuery%601.System.Collections.Generic.IEnumerable%3CT%3E.GetEnumerator%28%29at+System.Data.Entity.Internal.Linq.InternalQuery%601.GetEnumerator%28%29at+System.Data.Entity.Infrastructure.DbQuery%601.System.Collections.Generic.IEnumerable%3CTResult%3E.GetEnumerator%28%29at+System.Collections.Generic.List%601..ctor%28IEnumerable%601+collection%29at+System.Linq.Enumerable.ToList%5BTSource%5D%28IEnumerable%601+source%29">links to failing sites</a> and not to articles with solutions, as was expected, so I hope this post will be helpful for someone who will issue similar search query.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-06-10T00:00:00+03:00" pubdate data-updated="true">Jun 10<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/categories/dot-net/'>.NET</a>, <a class='category' href='/categories/orm/'>ORM</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/05/22/snapping-to-grid/">
		
			Snapping to Grid</a>
	</h2>
	<div class="entry-content">
		<p>Let&rsquo;s suppose user selects some value (real number) and you need to snap it to nearest point on discrete axis. No problem!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="kt">double</span> <span class="nf">SnapValue</span><span class="p">(</span><span class="kt">double</span> <span class="k">value</span><span class="p">,</span> <span class="kt">double</span> <span class="n">step</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">remainder</span> <span class="p">=</span> <span class="n">Math</span><span class="p">.</span><span class="n">IEEERemainder</span><span class="p">(</span><span class="k">value</span><span class="p">,</span> <span class="n">step</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">step</span><span class="p">/</span><span class="m">2</span> <span class="p">&gt;</span> <span class="n">remainder</span> <span class="p">?</span> <span class="k">value</span> <span class="p">-</span> <span class="n">remainder</span> <span class="p">:</span> <span class="k">value</span> <span class="p">+</span> <span class="n">remainder</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, assuming your you have an axis with step 0.5, value 10.2 will be snapped to 10 (closest node), and value 10.78, in turn, &ndash; to 11.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-05-22T00:00:00+03:00" pubdate data-updated="true">May 22<span>nd</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/categories/dot-net/'>.NET</a>, <a class='category' href='/categories/math/'>Math</a>, <a class='category' href='/categories/snippet/'>Snippet</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/05/22/asp-net-file-upload-possible-issue/">
		
			ASP.NET File Upload Possible Issue</a>
	</h2>
	<div class="entry-content">
		<p>One of issues you can face when developing web application with use of ASP.NET MVC and IIS 7.5 is maximal request size. No doubt, after googling, you&rsquo;ll find that cause is request size limit, so you&rsquo;ll happily add to web.config following line and forget about this.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;httpRuntime</span> <span class="na">maxRequestLength=</span><span class="s">&quot;100000&quot;</span><span class="nt">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>But if under some circumstances you&rsquo;ll find that controller&rsquo;s action responsible for receiving of large file is not being triggered but instead application returns 404 code, try following solution. Please note, in this case content length should be provided in bytes, not kilobytes like in prevous example.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;security&gt;</span>
</span><span class='line'>    <span class="nt">&lt;requestFiltering&gt;</span>
</span><span class='line'>        <span class="nt">&lt;requestLimits</span> <span class="na">maxAllowedContentLength=</span><span class="s">&quot;100000000&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/requestFiltering&gt;</span>
</span><span class='line'><span class="nt">&lt;/security&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>For me, while working with Windows integrated authentication, this helped a lot. Thanks to <a href="http://stackoverflow.com/a/6687932">StackOverflow</a>!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-05-22T00:00:00+03:00" pubdate data-updated="true">May 22<span>nd</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/categories/dot-net/'>.NET</a>, <a class='category' href='/categories/web/'>Web</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/04/29/when-ilist-has-indexer-but-does-not-have-enumerator/">
		
			When IList Has Indexer but Does Not Have Enumerator</a>
	</h2>
	<div class="entry-content">
		<p>What can you expect from type implementing <code>IList</code>? Surely, availability of enumerator, which give you a power of LINQ! But do not be so fast, sometimes this assumption can be wrong! For example, yesterday I&rsquo;ve found that some types in XAF (eXpress Application Framework by DevExpress) can implement <code>IList</code> having the indexer but at the same time no enumerator!</p>

<p>Imagine you are implementing handler for some controller&rsquo;s action where you need to access all items from <code>ListView</code>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="p">...</span>
</span><span class='line'><span class="kt">var</span> <span class="n">records</span> <span class="p">=</span> <span class="n">listView</span><span class="p">.</span><span class="n">CollectionSource</span><span class="p">.</span><span class="n">List</span><span class="p">.</span><span class="n">Cast</span><span class="p">&lt;</span><span class="n">MyType</span><span class="p">&gt;().</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Instance <code>listView.CollectionSource.List</code> is of type implementing <code>IList</code>, so you can expect reference to list of <code>MyType</code> instances in the <code>records</code> variable, but you&rsquo;ll receive <code>System.NotSupportedException</code>!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'>  <span class="n">System</span><span class="p">.</span><span class="n">NotSupportedException</span> <span class="n">was</span> <span class="n">unhandled</span> <span class="n">by</span> <span class="n">user</span> <span class="n">code</span>
</span><span class='line'>  <span class="n">Message</span><span class="p">=</span><span class="n">Specified</span> <span class="n">method</span> <span class="k">is</span> <span class="n">not</span> <span class="n">supported</span><span class="p">.</span>
</span><span class='line'>  <span class="n">Source</span><span class="p">=</span><span class="n">DevExpress</span><span class="p">.</span><span class="n">Xpo</span><span class="p">.</span><span class="n">v10</span><span class="p">.</span><span class="m">2</span>
</span><span class='line'>  <span class="n">StackTrace</span><span class="p">:</span>
</span><span class='line'>       <span class="n">at</span> <span class="n">DevExpress</span><span class="p">.</span><span class="n">Xpo</span><span class="p">.</span><span class="n">Helpers</span><span class="p">.</span><span class="n">XpoServerCollectionAdderRemover</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">()</span>
</span><span class='line'>       <span class="n">at</span> <span class="n">DevExpress</span><span class="p">.</span><span class="n">Xpo</span><span class="p">.</span><span class="n">Helpers</span><span class="p">.</span><span class="n">XpoServerCollectionWrapperBase</span><span class="p">.</span><span class="n">GetEnumerator</span><span class="p">()</span>
</span><span class='line'>       <span class="n">at</span> <span class="n">System</span><span class="p">.</span><span class="n">Linq</span><span class="p">.</span><span class="n">Enumerable</span><span class="p">.&lt;</span><span class="n">CastIterator</span><span class="p">&gt;</span><span class="n">d__aa</span><span class="err">`</span><span class="m">1.</span><span class="n">MoveNext</span><span class="p">()</span>
</span><span class='line'>       <span class="n">at</span> <span class="n">System</span><span class="p">.</span><span class="n">Collections</span><span class="p">.</span><span class="n">Generic</span><span class="p">.</span><span class="n">List</span><span class="err">`</span><span class="m">1.</span><span class="p">.</span><span class="n">ctor</span><span class="p">(</span><span class="n">IEnumerable</span><span class="err">`</span><span class="m">1</span> <span class="n">collection</span><span class="p">)</span>
</span><span class='line'>       <span class="n">at</span> <span class="n">System</span><span class="p">.</span><span class="n">Linq</span><span class="p">.</span><span class="n">Enumerable</span><span class="p">.</span><span class="n">ToList</span><span class="p">[</span><span class="n">TSource</span><span class="p">](</span><span class="n">IEnumerable</span><span class="err">`</span><span class="m">1</span> <span class="n">source</span><span class="p">)</span>
</span><span class='line'>       <span class="n">at</span> <span class="n">MyProject</span><span class="p">.</span><span class="n">MyController</span><span class="p">.</span><span class="n">HandleMyAction</span><span class="p">(</span><span class="n">Object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">SimpleActionExecuteEventArgs</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>       <span class="n">at</span> <span class="n">DevExpress</span><span class="p">.</span><span class="n">ExpressApp</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">SimpleAction</span><span class="p">.</span><span class="n">RaiseExecute</span><span class="p">(</span><span class="n">ActionBaseEventArgs</span> <span class="n">eventArgs</span><span class="p">)</span>
</span><span class='line'>       <span class="n">at</span> <span class="n">DevExpress</span><span class="p">.</span><span class="n">ExpressApp</span><span class="p">.</span><span class="n">Actions</span><span class="p">.</span><span class="n">ActionBase</span><span class="p">.</span><span class="n">ExecuteCore</span><span class="p">(</span><span class="n">Delegate</span> <span class="n">handler</span><span class="p">,</span> <span class="n">ActionBaseEventArgs</span> <span class="n">eventArgs</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>So, what should you do? Use indexer!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="p">...</span>
</span><span class='line'><span class="kt">var</span> <span class="n">records</span> <span class="p">=</span> <span class="n">Enumerable</span><span class="p">.</span><span class="n">Range</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">listView</span><span class="p">.</span><span class="n">CollectionSource</span><span class="p">.</span><span class="n">List</span><span class="p">.</span><span class="n">Count</span><span class="p">).</span><span class="n">Select</span><span class="p">(</span>
</span><span class='line'>  <span class="n">index</span> <span class="p">=&gt;</span> <span class="n">listView</span><span class="p">.</span><span class="n">CollectionSource</span><span class="p">.</span><span class="n">List</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="k">as</span> <span class="n">MyType</span><span class="p">).</span><span class="n">ToList</span><span class="p">();</span>
</span><span class='line'><span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>


<p>Is it so hard for framework developers to implement enumerator if type already has indexer? I think no. So it&rsquo;s very strange that we should bother ourselves with such things. But anyway the solution is not so hard, so generally everything is OK.</p>

<p><em>P. S.</em> Also it&rsquo;s quite strange and unintuitive that we should access items of list view through <code>listView.CollectionSource.List</code> instead of <code>listView.List</code> or <code>listView.Items</code>, especially, when such properties do exist, but intended for another purposes (internal). But that is another story.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-04-29T00:00:00+03:00" pubdate data-updated="true">Apr 29<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/categories/dot-net/'>.NET</a>, <a class='category' href='/categories/devexpress/'>DevExpress</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/04/04/xpath-select-node-with-child-containing-given-substring/">
		
			XPath: Select Node With Child Containing Given Substring</a>
	</h2>
	<div class="entry-content">
		<p>XPath is very interesting topic, essentially it allows you to do quite sophisticated things. And in this short post, I&rsquo;ll give example how to create a little more complex than plain query: it will return all books, which contains &ldquo;C++&rdquo; in any of its childrens&#8217; texts (please, see <a href="http://msdn.microsoft.com/en-us/library/windows/desktop/ms762271%28v=vs.85%29.aspx">example of such XML here</a>).</p>

<p>So, our query is following:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>//*[contains(text(), 'C++')]/parent::book</span></code></pre></td></tr></table></div></figure>


<p>It will return:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;book</span> <span class="na">id=</span><span class="s">&quot;bk112&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;author&gt;</span>Galos, Mike<span class="nt">&lt;/author&gt;</span>
</span><span class='line'>    <span class="nt">&lt;title&gt;</span>Visual Studio 7: A Comprehensive Guide<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>    <span class="nt">&lt;genre&gt;</span>Computer<span class="nt">&lt;/genre&gt;</span>
</span><span class='line'>    <span class="nt">&lt;price&gt;</span>49.95<span class="nt">&lt;/price&gt;</span>
</span><span class='line'>    <span class="nt">&lt;publish_date&gt;</span>2001-04-16<span class="nt">&lt;/publish_date&gt;</span>
</span><span class='line'>    <span class="nt">&lt;description&gt;</span>Microsoft Visual Studio 7 is explored in depth,
</span><span class='line'>    looking at how Visual Basic, Visual C++, C#, and ASP+ are
</span><span class='line'>    integrated into a comprehensive development
</span><span class='line'>    environment.<span class="nt">&lt;/description&gt;</span>
</span><span class='line'><span class="nt">&lt;/book&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it. Simple. But useful, especially if you haven&rsquo;t worked with XPath too much before.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-04-04T00:00:00+03:00" pubdate data-updated="true">Apr 4<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/categories/xpath/'>XPath</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/04/04/dealing-with-namespaces-in-xpath-net/">
		
			Dealing With Namespaces in XPath (.NET)</a>
	</h2>
	<div class="entry-content">
		<p>This post is kind of short but useful note for those who are dealing with namespaces in XPath, especially if there is default namespace (with empty prefix).</p>

<p>Normally, when doing queries to document <em>with namespaces</em>, you involve <code>XmlNamespaceManager</code> like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="kt">var</span> <span class="n">namespaceManager</span> <span class="p">=</span> <span class="k">new</span> <span class="n">XmlNamespaceManager</span><span class="p">(</span><span class="n">document</span><span class="p">.</span><span class="n">NameTable</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">var</span> <span class="n">namespaces</span> <span class="p">=</span> <span class="n">document</span>
</span><span class='line'>    <span class="p">.</span><span class="n">DocumentElement</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Attributes</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Cast</span><span class="p">&lt;</span><span class="n">XmlAttribute</span><span class="p">&gt;()</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="s">&quot;xmlns&quot;</span><span class="p">))</span>
</span><span class='line'>    <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="k">new</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">Prefix</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="m">5</span>
</span><span class='line'>                            <span class="p">?</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="m">6</span><span class="p">)</span> <span class="c1">// case when name is like &quot;xmlns:something&quot;</span>
</span><span class='line'>                            <span class="p">:</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span> <span class="c1">// case when name is &quot;xmlns&quot; - default namespace</span>
</span><span class='line'>            <span class="n">Uri</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">Value</span>
</span><span class='line'>        <span class="p">});</span>
</span><span class='line'>
</span><span class='line'><span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">ns</span> <span class="k">in</span> <span class="n">namespaces</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="n">namespaceManager</span><span class="p">.</span><span class="n">AddNamespace</span><span class="p">(</span><span class="n">ns</span><span class="p">.</span><span class="n">Prefix</span><span class="p">,</span> <span class="n">ns</span><span class="p">.</span><span class="n">Uri</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">var</span> <span class="n">nodes</span> <span class="p">=</span> <span class="n">document</span><span class="p">.</span><span class="n">SelectNodes</span><span class="p">(</span><span class="s">&quot;//node/subnode&quot;</span><span class="p">,</span> <span class="n">namespaceManager</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>But wait! This query <em>will return no results</em>! The reason is not so obvious: you <em>must use prefix for default namespace</em>, it can&rsquo;t be omitted! So, to make such queries working, we need to change the initial code as well as XPath query:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="p">...</span>
</span><span class='line'>            <span class="n">Prefix</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">Length</span> <span class="p">&gt;</span> <span class="m">5</span>
</span><span class='line'>                            <span class="p">?</span> <span class="n">x</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">Substring</span><span class="p">(</span><span class="m">6</span><span class="p">)</span> <span class="c1">// case when name is like &quot;xmlns:something&quot;</span>
</span><span class='line'>                            <span class="p">:</span> <span class="s">&quot;default&quot;</span><span class="p">,</span> <span class="c1">// case when name is &quot;xmlns&quot; - default namespace</span>
</span><span class='line'>            <span class="n">Uri</span> <span class="p">=</span> <span class="n">x</span><span class="p">.</span><span class="n">Value</span>
</span><span class='line'><span class="p">...</span>
</span><span class='line'><span class="kt">var</span> <span class="n">nodes</span> <span class="p">=</span> <span class="n">document</span><span class="p">.</span><span class="n">SelectNodes</span><span class="p">(</span><span class="s">&quot;//default:node/default:subnode&quot;</span><span class="p">,</span> <span class="n">namespaceManager</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Good, now it&rsquo;s OK, we&rsquo;ve got our results.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-04-04T00:00:00+03:00" pubdate data-updated="true">Apr 4<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/categories/dot-net/'>.NET</a>, <a class='category' href='/categories/xpath/'>XPath</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/04/03/extracting-tables-from-microsoft-word-2007-openxml-document/">
		
			Extracting Tables From Microsoft Word 2007+ (OpenXML) Document</a>
	</h2>
	<div class="entry-content">
		<p>Let&rsquo;s suppose we have huge Word 2007+ document (*.docx) with lots of tables and we want to extract that information for further processing. Since our document is based on OpenXML format I would say &ldquo;No problem! Let&rsquo;s do it!&rdquo;.</p>

<p>First, we need to open zip archive (each *.docx is zipped set of XML files). For this purpose we can use great library DotNetZip (just use NuGet to obtain it). Right after this we&rsquo;ll read word/document.xml entry.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">file</span> <span class="p">=</span> <span class="n">ZipFile</span><span class="p">.</span><span class="n">Read</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">0</span><span class="p">]))</span>
</span><span class='line'>    <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">inputStream</span> <span class="p">=</span> <span class="n">file</span><span class="p">[</span><span class="s">&quot;word/document.xml&quot;</span><span class="p">].</span><span class="n">OpenReader</span><span class="p">())</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="kt">var</span> <span class="n">document</span> <span class="p">=</span> <span class="k">new</span> <span class="n">XmlDocument</span><span class="p">();</span>
</span><span class='line'>        <span class="n">document</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">inputStream</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="kt">var</span> <span class="n">tables</span> <span class="p">=</span> <span class="n">ExtractTables</span><span class="p">(</span><span class="n">document</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">outputStream</span> <span class="p">=</span> <span class="n">File</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="m">1</span><span class="p">]))</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="k">new</span> <span class="nf">XmlSerializer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">Table</span><span class="p">[])).</span><span class="n">Serialize</span><span class="p">(</span><span class="n">outputStream</span><span class="p">,</span> <span class="n">tables</span><span class="p">);</span>
</span><span class='line'>        <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then we&rsquo;ll extract neccessary pieces using XPath: our target is <code>w:tbl</code> nodes (tables) with such descendants as <code>w:tr</code> (rows), <code>w:tc</code> (cells) and <code>w:t</code> (text pieces).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">private</span> <span class="k">static</span> <span class="n">Table</span><span class="p">[]</span> <span class="nf">ExtractTables</span><span class="p">(</span><span class="n">XmlNode</span> <span class="n">document</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">document</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="s">&quot;//w:tbl&quot;</span><span class="p">,</span> <span class="n">tableNode</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">Table</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Rows</span> <span class="p">=</span> <span class="n">tableNode</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="s">&quot;.//w:tr&quot;</span><span class="p">,</span> <span class="n">rowNode</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">Row</span>
</span><span class='line'>        <span class="p">{</span>
</span><span class='line'>            <span class="n">Cells</span> <span class="p">=</span> <span class="n">rowNode</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="s">&quot;.//w:tc&quot;</span><span class="p">,</span> <span class="n">cellNode</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">Cell</span>
</span><span class='line'>            <span class="p">{</span>
</span><span class='line'>                <span class="n">Text</span> <span class="p">=</span> <span class="n">cellNode</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="s">&quot;.//w:t&quot;</span><span class="p">,</span> <span class="n">textNode</span> <span class="p">=&gt;</span> <span class="n">textNode</span><span class="p">.</span><span class="n">InnerText</span><span class="p">)</span>
</span><span class='line'>            <span class="p">})</span>
</span><span class='line'>        <span class="p">})</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Classes <code>Table</code>, <code>Row</code> and <code>Cell</code> are simple DTOs used for simplifying of result serialization.</p>

<p>One more thing is <code>.Select()</code> extension method &ndash; it&rsquo;s implemented in the following way:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="n">T</span><span class="p">[]</span> <span class="n">Select</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="k">this</span> <span class="n">XmlNode</span> <span class="n">node</span><span class="p">,</span> <span class="kt">string</span> <span class="n">xpath</span><span class="p">,</span> <span class="n">Func</span><span class="p">&lt;</span><span class="n">XmlNode</span><span class="p">,</span> <span class="n">T</span><span class="p">&gt;</span> <span class="n">selector</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">node</span>
</span><span class='line'>        <span class="p">.</span><span class="n">SelectNodes</span><span class="p">(</span><span class="n">xpath</span><span class="p">,</span> <span class="n">GetOrCreateNamespaceManager</span><span class="p">((</span><span class="n">node</span> <span class="k">as</span> <span class="n">XmlDocument</span> <span class="p">??</span> <span class="n">node</span><span class="p">.</span><span class="n">OwnerDocument</span><span class="p">).</span><span class="n">NameTable</span><span class="p">))</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Cast</span><span class="p">&lt;</span><span class="n">XmlNode</span><span class="p">&gt;()</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">selector</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="n">ToArray</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Method .GetOrCreateNamespaceManager() returns namespace manager as it&rsquo;s required for making of XPath queries with use of namespaces. There is only one parameter for it &ndash; name table instance.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">private</span> <span class="k">static</span> <span class="n">XmlNamespaceManager</span> <span class="nf">GetOrCreateNamespaceManager</span><span class="p">(</span><span class="n">XmlNameTable</span> <span class="n">nameTable</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">if</span> <span class="p">(</span><span class="n">manager</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">manager</span> <span class="p">=</span> <span class="k">new</span> <span class="n">XmlNamespaceManager</span><span class="p">(</span><span class="n">nameTable</span><span class="p">);</span>
</span><span class='line'>        <span class="n">manager</span><span class="p">.</span><span class="n">AddNamespace</span><span class="p">(</span><span class="s">&quot;w&quot;</span><span class="p">,</span> <span class="s">&quot;http://schemas.openxmlformats.org/wordprocessingml/2006/main&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">manager</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&rsquo;s it! Due to openness of new Word document&rsquo;s format our initial task is so simple in implementation that it takes no more than couple of hours to implement it.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-04-03T00:00:00+03:00" pubdate data-updated="true">Apr 3<span>rd</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/categories/dot-net/'>.NET</a>, <a class='category' href='/categories/dataextraction/'>DataExtraction</a>, <a class='category' href='/categories/msoffice/'>MSOffice</a>, <a class='category' href='/categories/xpath/'>XPath</a>


</div>
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/03/24/bdd-with-specflow-and-watin/">
		
			BDD With SpecFlow and WatiN</a>
	</h2>
	<div class="entry-content">
		<p>I&rsquo;ve long heard about BDD, and recently viewed lectures from <a href="http://saas-class.org">SaaS class</a>really interested me not only in Ruby (with such great frameworks as Rails and Cucumber), but also in practical use of this methodology in .NET, which is my main platform at the moment. So, I decided to try writing small web app using BDD approach assisted by SpecFlow tool for definition of features and latter execution of test based on them, and WatiN as tool which would help to grab content from browser to make assertions on expected results.</p>

<p>Here is the feature file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='gherkin'><span class='line'><span class="k">Feature:</span><span class="nf"> Viewing of rates</span>
</span><span class='line'><span class="nf"> In order to view available conversion rates</span>
</span><span class='line'><span class="nf"> As a user</span>
</span><span class='line'><span class="nf"> I want to see current rates as well as their changes history</span>
</span><span class='line'>
</span><span class='line'><span class="k">Scenario:</span><span class="nf"> View current rates</span>
</span><span class='line'><span class="k">  Given </span><span class="nf">I have following exchange rates in the system</span>
</span><span class='line'><span class="k">      |</span><span class="s"> From</span><span class="k"> |</span><span class="s"> To </span><span class="k">|</span><span class="s"> Rate</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">      |</span><span class="s"> USD </span><span class="k">|</span><span class="s"> UAH</span><span class="k"> |</span><span class="s"> 8.03</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">      |</span><span class="s"> RUR </span><span class="k">|</span><span class="s"> UAH</span><span class="k"> |</span><span class="s"> 0.27</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="nf"> </span><span class="k">When </span><span class="nf">I am on home page</span>
</span><span class='line'><span class="nf"> </span><span class="k">Then </span><span class="nf">I should see following rows</span>
</span><span class='line'><span class="k">      |</span><span class="s"> V1 </span><span class="k">|</span><span class="s"> V2 </span><span class="k">|</span><span class="s"> V3  </span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">      |</span><span class="s"> USD</span><span class="k"> |</span><span class="s"> UAH</span><span class="k"> |</span><span class="s"> 8.0300</span><span class="k"> |</span><span class="nf"></span>
</span><span class='line'><span class="k">      |</span><span class="s"> RUR</span><span class="k"> |</span><span class="s"> UAH</span><span class="k"> |</span><span class="s"> 0.2700</span><span class="k"> |</span>
</span></code></pre></td></tr></table></div></figure>


<p>Implementation of most steps is pretty straightforward and not listed here, except &ldquo;Then&rdquo; step. So, below is its initial implementation.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Then(@&quot;I should see following rows&quot;)]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">ThenIShouldSeeFollowingRows</span><span class="p">(</span><span class="n">Table</span> <span class="n">table</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">row</span> <span class="k">in</span> <span class="n">table</span><span class="p">.</span><span class="n">Rows</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span>
</span><span class='line'>            <span class="n">Browser</span><span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">&quot;exchange-rates&quot;</span><span class="p">).</span><span class="n">TableRows</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span>
</span><span class='line'>                <span class="n">exchangeRate</span> <span class="p">=&gt;</span> <span class="n">row</span><span class="p">.</span><span class="n">Values</span><span class="p">.</span><span class="n">All</span><span class="p">(</span>
</span><span class='line'>                    <span class="n">text</span> <span class="p">=&gt;</span> <span class="n">exchangeRate</span><span class="p">.</span><span class="n">TableCell</span><span class="p">(</span><span class="n">Find</span><span class="p">.</span><span class="n">ByText</span><span class="p">(</span><span class="n">text</span><span class="p">)).</span><span class="n">Exists</span><span class="p">)),</span>
</span><span class='line'>            <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;Page contains following row: {0}.&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">.</span><span class="n">ToReadableString</span><span class="p">()));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Being WatiN newbie, I&rsquo;d made a step on a rake and trial to execute scenario led to StackOverflowException in WatiN.Core, so after googling a bit I decided to parse table first and only then make assertions. Said &ndash; done: updated implementation is below.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">csharp</span><span class="p">[</span><span class="n">Then</span><span class="p">(</span><span class="s">@&quot;I should see following rows&quot;</span><span class="p">)]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">ThenIShouldSeeFollowingRows</span><span class="p">(</span><span class="n">Table</span> <span class="n">table</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">actualTable</span> <span class="p">=</span> <span class="n">Browser</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Table</span><span class="p">(</span><span class="s">&quot;exchange-rates&quot;</span><span class="p">)</span>
</span><span class='line'>        <span class="p">.</span><span class="n">TableRows</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">r</span> <span class="p">=&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">TableCells</span><span class="p">.</span><span class="n">Any</span><span class="p">())</span>
</span><span class='line'>        <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">r</span> <span class="p">=&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">TableCells</span><span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">c</span> <span class="p">=&gt;</span> <span class="n">c</span><span class="p">.</span><span class="n">Text</span><span class="p">.</span><span class="n">Trim</span><span class="p">()).</span><span class="n">ToArray</span><span class="p">())</span>
</span><span class='line'>        <span class="p">.</span><span class="n">ToArray</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">row</span> <span class="k">in</span> <span class="n">table</span><span class="p">.</span><span class="n">Rows</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="n">Assert</span><span class="p">.</span><span class="n">That</span><span class="p">(</span>
</span><span class='line'>            <span class="n">actualTable</span><span class="p">.</span><span class="n">Any</span><span class="p">(</span><span class="n">r</span> <span class="p">=&gt;</span> <span class="n">row</span><span class="p">.</span><span class="n">All</span><span class="p">(</span><span class="n">v</span> <span class="p">=&gt;</span> <span class="n">r</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">v</span><span class="p">.</span><span class="n">Value</span><span class="p">))),</span>
</span><span class='line'>            <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;Page contains following row: {0}.&quot;</span><span class="p">,</span> <span class="n">row</span><span class="p">.</span><span class="n">ToReadableString</span><span class="p">()));</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Please note that Trim() call on text of cell: it&rsquo;s important since text can be, for example, with trailing space (as it was in my case).</p>

<p>So, finally I can get to actual implementation of this feature and then, running the above scenario, obtain long-awaited result.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="n">ViewCurrentRates</span> <span class="p">:</span> <span class="n">Passed</span>
</span><span class='line'><span class="n">Given</span> <span class="n">I</span> <span class="n">have</span> <span class="n">following</span> <span class="n">exchange</span> <span class="n">rates</span> <span class="k">in</span> <span class="n">the</span> <span class="n">system</span>
</span><span class='line'>  <span class="p">---</span> <span class="n">table</span> <span class="n">step</span> <span class="n">argument</span> <span class="p">---</span>
</span><span class='line'>  <span class="p">|</span> <span class="n">From</span> <span class="p">|</span> <span class="n">To</span>  <span class="p">|</span> <span class="n">Rate</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="n">USD</span>  <span class="p">|</span> <span class="n">UAH</span> <span class="p">|</span> <span class="m">8.03</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="n">RUR</span>  <span class="p">|</span> <span class="n">UAH</span> <span class="p">|</span> <span class="m">0.27</span> <span class="p">|</span>
</span><span class='line'><span class="p">-&gt;</span> <span class="n">done</span><span class="p">:</span> <span class="n">DataPreparationSteps</span><span class="p">.</span><span class="n">GivenIHaveFollowingExchangeRatesInTheSystem</span><span class="p">(&lt;</span><span class="n">table</span><span class="p">&gt;)</span> <span class="p">(</span><span class="m">7</span><span class="p">,</span><span class="m">9</span><span class="n">s</span><span class="p">)</span>
</span><span class='line'><span class="n">When</span> <span class="n">I</span> <span class="n">am</span> <span class="n">on</span> <span class="n">home</span> <span class="n">page</span>
</span><span class='line'><span class="p">-&gt;</span> <span class="n">done</span><span class="p">:</span> <span class="n">NavigationSteps</span><span class="p">.</span><span class="n">WhenIAmOnPage</span><span class="p">(</span><span class="s">&quot;home&quot;</span><span class="p">)</span> <span class="p">(</span><span class="m">5</span><span class="p">,</span><span class="m">1</span><span class="n">s</span><span class="p">)</span>
</span><span class='line'><span class="n">Then</span> <span class="n">I</span> <span class="n">should</span> <span class="n">see</span> <span class="n">following</span> <span class="n">rows</span>
</span><span class='line'>  <span class="p">---</span> <span class="n">table</span> <span class="n">step</span> <span class="n">argument</span> <span class="p">---</span>
</span><span class='line'>  <span class="p">|</span> <span class="n">V1</span>  <span class="p">|</span> <span class="n">V2</span>  <span class="p">|</span> <span class="n">V3</span>     <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="n">USD</span> <span class="p">|</span> <span class="n">UAH</span> <span class="p">|</span> <span class="m">8.0300</span> <span class="p">|</span>
</span><span class='line'>  <span class="p">|</span> <span class="n">RUR</span> <span class="p">|</span> <span class="n">UAH</span> <span class="p">|</span> <span class="m">0.2700</span> <span class="p">|</span>
</span><span class='line'><span class="p">-&gt;</span> <span class="n">done</span><span class="p">:</span> <span class="n">VerificationSteps</span><span class="p">.</span><span class="n">ThenIShouldSeeFollowingRows</span><span class="p">(&lt;</span><span class="n">table</span><span class="p">&gt;)</span> <span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">4</span><span class="n">s</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Overall impressions: even if it adds some difficulties (especially at the beginning), I think it&rsquo;s great idea to practice BDD, and as for tooling: both SpecFlow and WatiN are nice and intuitive, and it cost quite low effort to get familiar with them (at least in this certain case).</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-03-24T00:00:00+02:00" pubdate data-updated="true">Mar 24<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/categories/dot-net/'>.NET</a>, <a class='category' href='/categories/testing/'>Testing</a>


</div>
	
</div>
</article>

<nav id="pagenavi">
    
    
        <a href="/./page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Constantin Titarenko

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'titarenko-blog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//go.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-42360735-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>